<%/*
Requires:
    setlists
    band
    allowEdit
    archive (if allowEdit == true)


    <link rel="stylesheet" href="/stylesheets/listSortStyle.css">
    <link rel="stylesheet" href="/stylesheets/tagStyle.css">

    <script src="/scripts/tagsInit.js"></script>
    <script src="/scripts/setlistListInit.js"></script>
    <script src="/scripts/collapsibleInit.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/list.js/2.3.1/list.min.js"></script>

*/%>
<div id="setlists">
                
    <div class="row">
        <div class="input-field">
            <i class="material-icons prefix">search</i>
            <input id="searchBar" type="text" class="search">
            <label for="searchBar">Search by Setlist Name, Date, Description, or Songs</label>
        </div>
    </div>
    <div class="row">
        <button class="btn-flat sort waves-light waves-effect" data-sort="name">Sort by Name</button>
        <button class="btn-flat sort waves-light waves-effect" data-sort="date-yyyymmdd" data-default-order="desc">Sort by Date</button>
        <button class="btn-flat sort waves-light waves-effect" data-sort="updated-at-yyyymmdd" data-default-order="desc">Sort by Last Updated</button>
        <ul class="pagination paginationTop right"></ul>
    </div>

    <ul class="collapsible expandable popout list tooltipped" data-position="top" data-tooltip="Click row to preview setlist; click set icon or name to edit setlist.">
        <% for (setlist of setlists) { %>
        <li>
            <div class="collapsible-header valign-wrapper">
                <a href="/band/<%= band.band_id %>/setlist/<%= setlist.setlist_id %>">
                    <i class="material-icons">queue_music</i>
                </a>
                <div>
                    <a class="name" href="/band/<%= band.band_id %>/setlist/<%= setlist.setlist_id %>">
                        <%= setlist.name %>
                    </a>
                    <br>
                    <span class="date-pretty date-yyyymmdd" data-date="<%= setlist.date_yyyymmdd%>"> <%= setlist.date_pretty%> </span>
                </div>
                
                    <span class="new badge <% if (setlist.song_count == 0) { %> red <% } %>" data-badge-caption="ðŸŽµ"><%= setlist.song_count%></span>
                
            </div>
            <div class="collapsible-body">
                <% if (allowEdit) { %>

                    <% if (archive) { %>
                    <form class="right confirm-submit" method="post" display="inline"
                        action="/band/<%=band.band_id%>/setlist/<%=setlist.setlist_id%>"
                        data-confirm-msg='Confirm that you want to UN-archive the setlist "<%=setlist.name%>":'
                    >

                        <input type="hidden" name="method" value="unarchive">

                        <button class="btn-small btn-floating waves-effect waves-light green tooltipped" type="submit"
                        data-tooltip="Unarchive" data-position="top">
                            <i class="material-icons right">unarchive</i>
                        </button>
                    </form>

                    <form class="confirm-submit right" method="post" display="inline"
                        action="/band/<%=band.band_id%>/setlist/<%=setlist.setlist_id%>"
                        data-confirm-msg='Confirm that you want to delete this setlist by retyping "<%=setlist.name%>":'
                        data-require-retype="<%=setlist.name%>">

                        <input type="hidden" name="method" value="delete">
                        <% if (archive) { %>
                            <input type="hidden" name="redirect" value="archive">
                        <% } %>

                        <button class="btn-small btn-floating waves-effect waves-light red tooltipped" type="submit"
                            data-tooltip="Delete" data-position="top">

                            <i class="material-icons right">delete</i>
                            Delete
                        </button>
                    </form>
                    <% } else { %>
                        <form class="right confirm-submit" method="post" display="inline"
                            action="/band/<%=band.band_id%>/setlist/<%=setlist.setlist_id%>"
                            data-confirm-msg='Confirm that you want to archive the setlist "<%=setlist.name%>":'
                        >

                            <input type="hidden" name="method" value="archive">

                            <button class="btn-small btn-floating waves-effect waves-light grey tooltipped" type="submit"
                                data-tooltip="Archive" data-position="top">
                                <i class="material-icons right">archive</i>
                            </button>
                        </form>
                    <% } %>
                <% } %>


                <div class="descr"><%= setlist.descr %></div>
                <%if (setlist.songs) {%>
                <div class="songs" data-tags="<%=setlist.songs%>" >
                    <div class="chips tags readonly no-autoinit">
                        <% for (tag of setlist.songs.split(",")) {
                            if (tag != '') {%>
                                <div class="chip">ðŸŽµ<%=tag%></div>
                        <%}}%>
                    </div>
                </div>
                <%} %>
                <div class="updated-at" data-updated-at="<%= setlist.updated_at_yyyymmdd%>">Last updated: <%= setlist.updated_at_pretty%></div>

                <% } %>

            </div>
        </li>

    </ul>
    <ul class="pagination paginationBottom right"></ul>

</div>