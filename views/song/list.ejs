<%# Must pass in:
{   songlist: [{title, artist, categoryId, categoryName, keyId, keyName, lastPlayedDate, lastPlayedDateReadable, notes}]
    archive: boolean,
}
%>
<% var viewDirRoot = '../'; %>
<% var isCoreMember = (band.member.role=='owner' || band.member.role=='core' ); %>
<% var promptSongCreation = !archive && (songlist.length == 0) && !locals?.search; %>
<!DOCTYPE html>
<html lang="en">

<head>
    <%- include(viewDirRoot + 'partials/stdhead', {title: `${archive ? "Archived Songs" : "Songs"} : ${band.name} `}) %>

    <link rel="stylesheet" href="/stylesheets/tagStyle.css">

    <!-- For the list of songs -->
    <link rel="stylesheet" href="/stylesheets/listSortStyle.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/list.js/2.3.1/list.min.js"></script>
</head>

<body>
        <%- include(viewDirRoot + 'partials/navbar', {breadcrumbs : 
            archive ? 
                [{href: `/band/${band.band_id}/`, text: band.name}, 
                    {href: `/band/${band.band_id}/song/list`, text: "Songs"},
                    {href: `/band/${band.band_id}/song/archive`, text: "Archive"}]
                :
                [{href: `/band/${band.band_id}/`, text: band.name}, 
                    {href: `/band/${band.band_id}/song/list`, text: "Songs"}]
        }) %>


    <!-- Actual page content! -->
    <div class="container">
        <div id="title">
                <h3><%=archive ? 'Song Archive:' : 'Songs:'; %>
                    <% if (archive) { %>

                        <a class="btn-flat" href="/band/<%=band.band_id%>/song/list"> 
                        View Un-Archived Songs</a>
                    
                    <% } else { %>
                            <a class="btn-flat" href="/band/<%=band.band_id%>/song/archive"> 
                            View Archived Songs</a>
                    <% } %>
                </h3>
                

                    <% if (promptSongCreation) { %>
                        <blockquote >
                            Looks like your band doesn't have any songs (yet). 
                            Click the <i class="material-icons">add_circle</i> in the bottom right to 
                            create a song. </br>
                        </blockquote>

                    <% } %>

        </div>
                
    
            <div id="songlist">
                 
                    <div class="row">
                        <div class="input-field">
                          <i class="material-icons prefix">search</i>
                          <input id="searchBar" type="text" class="search">
                          <label for="searchBar">Search by Title, Artist, Tags, Key, Tempo, or Recent Set</label>
                        </div>
                    </div>
                    <div class="row">
                        <button class="btn-flat sort waves-light waves-effect" data-sort="title">Sort by Title</button>
                        <button class="btn-flat sort waves-light waves-effect" data-sort="artist">Sort by Artist</button>
                        <button class="btn-flat sort waves-light waves-effect" data-sort="key">Sort by Key</button>
                        <button class="btn-flat sort waves-light waves-effect" data-sort="tempo">Sort by Tempo</button>
                        <button class="btn-flat sort waves-light waves-effect" data-sort="last-played">Sort by Last Played</button>
                        <ul class="pagination paginationTop right"></ul>
                    </div>

                <table>
                    <thead>
                        <tr>
                            <th><span class="sort" data-sort="title">Title</span></th>
                            <th><span class="sort" data-sort="artist">Artist</span></th>
                            <th>Tags</th>
                            <th><span class="sort" data-sort="key">Key</span></th>
                            <th><span class="sort" data-sort="tempo">Tempo</span></th>
                            <th><span class="sort" data-sort="last-played">Most Recent Set</span></th>
                            <% if (isCoreMember) { %>
                                <th>                    
                                </th>
                            <% } %>
                        </tr>
                
                    </thead>
                    <tbody  class="list">
                        <% for (song of songlist) { %>
                        <tr class="song_id" data-song-id="<%= song.song_id %>">
                            <td>
                                <a href="/band/<%= band.band_id %>/song/<%= song.song_id %>" class="title">
                                    <%= song.title %> 
                                </a>
                            </td>
                            <td class="artist"><%= song.artist %></td>
                            <td class="tags" data-tags="<%=song.tags%>" >
                                <div class="chips tags readonly no-autoinit">
                                    <% for (tag of song.tags.split(",")) {
                                        if (tag != '') {%>
                                            <div class="chip"><%=tag%></div>
                                    <%}}%>
                                </div>
                            </td>
                            <td class="key"><%= song.key%></td>
                            <td class="tempo"><%= song.tempo %></td>
                            <td class="last-played" data-last-played="<%= song.lastPlayedDate %>"><a href="/set/<%= song.set_id %>" class="recent-set" data-recent-set="<%= song.recent_set %>"><%= song.recent_set %> - <%= song.lastPlayedDateReadable %></a></td>
                            <% if (isCoreMember) { %>

                            <td>
                                <% if (archive) { %>
                                <form class="right confirm-submit" method="post" display="inline"
                                    action="/band/<%=band.band_id%>/song/<%=song.song_id%>"
                                    data-confirm-msg='Confirm that you want to UN-archive the song "<%=song.title%>":'
                                >

                                    <input type="hidden" name="method" value="unarchive">

                                    <button class="btn-small btn-floating waves-effect waves-light green tooltipped" type="submit"
                                    data-tooltip="Unarchive" data-position="top">
                                        <i class="material-icons right">unarchive</i>
                                    </button>
                                </form>

                                <form class="confirm-submit right" method="post" display="inline"
                                    action="/band/<%=band.band_id%>/song/<%=song.song_id%>"
                                    data-confirm-msg='Confirm that you want to delete this song by retyping "<%=song.title%>":'
                                    data-require-retype="<%=song.title%>">

                                    <input type="hidden" name="method" value="delete">
                                    <% if (archive) { %>
                                        <input type="hidden" name="redirect" value="archive">
                                    <% } %>

                                    <button class="btn-small btn-floating waves-effect waves-light red tooltipped" type="submit"
                                        data-tooltip="Delete" data-position="top">

                                        <i class="material-icons right">delete</i>
                                        Delete
                                    </button>
                                </form>
                                <% } else { %>
                                    <form class="right confirm-submit" method="post" display="inline"
                                        action="/band/<%=band.band_id%>/song/<%=song.song_id%>"
                                        data-confirm-msg='Confirm that you want to archive the song "<%=song.title%>":'
                                    >

                                        <input type="hidden" name="method" value="archive">

                                        <button class="btn-small btn-floating waves-effect waves-light grey tooltipped" type="submit"
                                            data-tooltip="Archive" data-position="top">
                                            <i class="material-icons right">archive</i>
                                        </button>
                                    </form>
                                <% } %>

                            </td>
                            <% } %>

                        </tr>
                        <% } %>
                    </tbody>
                </table>
                <ul class="pagination paginationBottom right"></ul>

            </div>

            <% if (!archive && isCoreMember) { %>

            <div class="fixed-action-btn">
                <a class="btn-floating btn-large waves-effect waves-light orange modal-trigger <%= promptSongCreation ? 'pulse' : '' %>" 
                href="#createsong"><i class="material-icons">add</i></a>
            </div>

            <div class="modal modal-fixed-footer" id="createsong">
    
                <div class="modal-content">
    
                    <form id="addSongForm" method="post">  
                        <h4>Add a new song:</h4>
                                        
                        <div class="row">
                            <div class="input-field col s6">
                                <input type="text" id="titleInput" name="title" class="validate" data-length="45" required>
                                <label for="titleInput">Title:</label>
                            </div>
                            <div class="input-field col s6">
                                <input type="text" id="artistInput" name="artist" class="validate" data-length="100">
                                <label for="artistInput">Artist:</label>
                            </div>
                        </div>
                    
                        <div class="row">
                   
                            <div class="col l8 m12 s12">

                                <div class="row">
                                    <div class="input-field col s6">
                                        <input type="text" id="keyInput" name="key" class="autocomplete key validate" data-length="30" >
                                        <label for="keyInput">(Typical) Key:</label>
                                    </div>
                            
                                    <div class="input-field col s6">
                                        <input type="text" id="tempoInput" name="tempo" class="validate" data-length="15" >
                                        <label for="tempoInput">Tempo:</label>

                                    </div>

                                </div>
                                <div class="row">
                                    <div class="input-field col s12">
                                        <textarea class="materialize-textarea" id="notesInput" name="notes"></textarea>
                                        <label for="notesInput">Additional Notes:</label>
                                    </div>
                                </div>
                            </div>
                        
                            
                            <div class="col l4 m12 s12">
                                <blockquote>
                                    <div id="tagsInput" class="chips tags no-autoinit">
                                </blockquote>
                            </div>
                        </div>

                    </form>                    

                    
                    
                </div>

                <div class="modal-footer">
                        <button class="btn waves-effect waves-light " type="submit" form="addSongForm">
                            <i class="material-icons right">send</i>
                            Add Song
                        </button>
                        <button class="modal-close waves-effect waves-green btn-flat" >Never Mind</button>
                </div>
    
            </div>

            <% } %>
        </div>

        <%- include(viewDirRoot + 'partials/stdfoot') %>
        <script src="/scripts/tagsInit.js"></script>
        <script src="/scripts/keyAutocomplete.js"></script>
        <script src="/scripts/songListInit.js"></script>


</body>

</html>